<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CareWare NORA | Medical Record</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            /* --- ŸÜÿ∏ÿßŸÖ ÿßŸÑÿ™ÿµŸÖŸäŸÖ --- */
            --primary: #0277BD;
            --primary-dark: #01579B;
            --accent: #FF8F00;
            --danger: #D32F2F;
            --success: #2E7D32;
            
            --surface: #FFFFFF;
            --background: #F4F6F8;
            --border: #CFD8DC;
            --text-main: #37474F;
            --text-light: #78909C;
            --input-bg: #FFFFFF;
            
            /* ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ */
            --sec-vitals: #FFF8E1; 
            --sec-vitals-border: #FFECB3;
            
            --sec-gas: #E0F2F1; --sec-gas-border: #B2DFDB;
            --sec-meds: #E3F2FD; --sec-meds-border: #BBDEFB;
            --sec-fluids: #F3E5F5; --sec-fluids-border: #E1BEE7;

            /* ÿ£ŸÑŸàÿßŸÜ ÿßŸÑŸÖŸÜÿ∑ŸÇ */
            --evt-signin: var(--success);
            --evt-timeout: var(--danger);
            --evt-std: var(--primary);
            --evt-crisis: #FF3D00;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --primary: #4FC3F7; --primary-dark: #0288D1;
                --surface: #263238; --background: #102027;
                --border: #37474F; --text-main: #ECEFF1;
                --text-light: #B0BEC5; --input-bg: #37474F;
                
                --sec-vitals: #3E2723; --sec-vitals-border: #5D4037;
                --sec-gas: #1B5E20; --sec-gas-border: #388E3C;
                --sec-meds: #0D47A1; --sec-meds-border: #1976D2;
                --sec-fluids: #4A148C; --sec-fluids-border: #7B1FA2;
            }
        }

        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--background);
            margin: 0; padding: 0 0 100px 0;
            color: var(--text-main); font-size: 11px; /* Decreased default font size */
        }

        .app-container {
            max-width: 1400px; margin: 0 auto; background: var(--surface);
            box-shadow: 0 0 20px rgba(0,0,0,0.05); min-height: 100vh;
            border-top: 6px solid var(--primary-dark);
        }

        /* ÿ±ÿ£ÿ≥ ÿßŸÑÿµŸÅÿ≠ÿ© */
        .system-top-bar {
            background: var(--primary-dark); color: white; padding: 6px 20px; /* Narrower header */
            display: flex; justify-content: space-between; align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 100;
        }

        /* ÿ¥ÿ±Ÿäÿ∑ ÿ®ŸäÿßŸÜÿßÿ™ ÿßŸÑŸÖÿ±Ÿäÿ∂ */
        .patient-context-bar {
            background: var(--surface); border-bottom: 1px solid var(--border);
            padding: 4px 15px; display: flex; align-items: flex-end; gap: 8px; flex-wrap: wrap;
        }
        
        .ctx-group { display: flex; flex-direction: column; gap: 1px; }
        .ctx-label { font-size: 8px; font-weight: 700; color: var(--text-light); text-transform: uppercase; }
        .ctx-input {
            background: var(--input-bg); border: 1px solid var(--border); border-radius: 4px;
            padding: 2px 6px; font-weight: bold; color: var(--primary); font-size: 12px; text-align: center;
            height: 26px; /* Narrower context inputs */
        }
        
        .w-name { flex: 2; min-width: 250px; text-align: left; }
        .w-mrn { width: 140px; }
        .w-age { width: 45px; }
        .w-wt { width: 60px; }
        .w-allergies { flex: 1; min-width: 150px; color: var(--danger); border-color: var(--danger); background: #FFEBEE; text-align: left;}

        /* ÿßŸÑÿ®ÿ∑ÿßŸÇÿßÿ™ */
        .cw-card {
            background: var(--surface); border: 1px solid var(--border);
            border-radius: 6px; margin: 6px 15px; position: relative;
            display: flex; flex-direction: column; overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        .cw-card-header {
            background: var(--background); padding: 3px 12px; font-weight: 700; color: var(--text-main);
            border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;
            font-size: 10px;
        }
        .cw-body { padding: 6px; flex: 1; display: flex; flex-direction: column; }

        /* ÿ£ŸÜÿ∏ŸÖÿ© ÿßŸÑÿ¥ÿ®ŸÉÿ© (Grid) */
        .details-grid {
            display: grid; grid-template-columns: 1fr 1fr 1fr; grid-template-rows: 1fr 1fr;
            grid-auto-flow: column; gap: 6px;
        }
        .airway-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 4px;
        }

        .detail-box {
            display: flex; flex-direction: column; border: 1px solid #E0E0E0;
            border-radius: 4px; padding: 2px 6px; background: #FAFAFA;
        }
        .detail-box.fixed-h { height: 40px; } /* Even narrower detail boxes */

        .detail-box label { font-size: 8px; font-weight: 700; color: var(--text-light); margin-bottom: 1px; text-transform: uppercase; letter-spacing: 0.5px; }
        .detail-box input[type="text"] { 
            width: 100%; flex: 1; border: none; background: transparent; 
            font-weight: 600; color: var(--text-main); font-size: 11px;
            border-bottom: 1px dashed #ccc; border-radius: 0; padding: 0;
            height: 16px;
        }
        .detail-box input:focus { border-bottom: 1px solid var(--primary); }

        /* ÿßŸÑŸÖÿØÿÆŸÑÿßÿ™ ÿßŸÑÿ¥ÿßÿ¶ÿπÿ© */
        .check-group { display: flex; gap: 8px; align-items: center; background: var(--background); padding: 2px 8px; border-radius: 4px; min-height: 20px; border: 1px solid var(--border); flex-wrap: wrap; }
        .check-item { display: flex; align-items: center; gap: 3px; cursor: pointer; font-size: 10px; color: var(--text-main); white-space: nowrap; }
        .check-item input { width: 12px; height: 12px; accent-color: var(--primary); }

        .detail-box .check-group { background: transparent; border: none; padding: 0; min-height: auto; gap: 4px; flex-wrap: wrap; }

        /* ÿßŸÑÿ¨ÿØŸàŸÑ ÿßŸÑÿ±ÿ¶Ÿäÿ≥Ÿä - NARROW HEIGHT ROWS */
        .table-wrap { 
            overflow-x: auto; 
            background: var(--border); 
            padding-bottom: 1px; 
            border-radius: 4px;
        }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 900px; background: var(--surface); }
        thead th {
            background: var(--primary-dark); color: white; padding: 2px 4px;
            border-right: 1px solid rgba(255,255,255,0.1); border-bottom: none;
            text-align: center; position: sticky; top: 0; z-index: 20; font-size: 10px;
        }
        thead th:first-child { 
            z-index: 40; background: var(--primary-dark); color: white; 
            text-align: left; padding-left: 10px; width: 180px; min-width: 180px;
        }
        td { border-right: 1px solid var(--border); border-bottom: 1px solid var(--border); height: 20px; padding: 0; text-align: center; background: var(--surface); }
        td input { width: 100%; height: 100%; border: none; text-align: center; background: transparent; font-weight: 500; font-size: 10px; padding: 0; color: var(--text-main); }
        th:first-child, td:first-child {
            position: sticky; left: 0; z-index: 30; width: 180px; min-width: 180px;
            background: var(--background); border-right: 2px solid var(--border);
            text-align: left; padding-left: 8px; font-weight: 600; color: var(--text-main); font-size: 10px;
        }
        .section-header td { 
            font-weight: 700; text-align: left; padding: 1px 12px; letter-spacing: 0.5px; 
            position: sticky; left: 0; z-index: 35; 
            pointer-events: auto;
            height: 20px; font-size: 10px;
        }
        .row-spacer td { height: 4px; background-color: var(--background); border: none; }

        /* ÿ£ŸÑŸàÿßŸÜ ÿßŸÑÿ£ŸÇÿ≥ÿßŸÖ ŸÅŸä ÿßŸÑÿ¨ÿØŸàŸÑ */
        .sec-vitals td { background: var(--sec-vitals); color: var(--text-main); border-bottom-color: var(--sec-vitals-border); } 
        .section-header.sec-vitals td { background: var(--sec-vitals-border) !important; color: #000; }
        
        .sec-gases td { background: var(--sec-gas); color: var(--text-main); border-bottom-color: var(--sec-gas-border); } 
        .section-header.sec-gases td { background: var(--sec-gas-border) !important; color: #000; }

        .sec-meds td { background: var(--sec-meds); color: var(--text-main); border-bottom-color: var(--sec-meds-border); } 
        .section-header.sec-meds td { background: var(--sec-meds-border) !important; color: #000; }

        .sec-fluids td { background: var(--sec-fluids); color: var(--text-main); border-bottom-color: var(--sec-fluids-border); } 
        .section-header.sec-fluids td { background: var(--sec-fluids-border) !important; color: #000; }

        /* ÿßŸÑÿ™ÿ≠ŸÉŸÖ */
        .macro-select, .interval-select { padding: 1px 4px; border-radius: 4px; border: 1px solid var(--border); color: var(--text-main); font-weight: bold; font-size: 10px; background: var(--input-bg); }
        button#btnAddTime { background: var(--success); color: white; border: none; padding: 2px 10px; border-radius: 4px; font-weight: bold; font-size: 10px; }
        button#btnAddTime:disabled { background-color: var(--border) !important; color: var(--text-light); }
        .btn-mini-add { background: var(--surface); border: 1px solid var(--primary); color: var(--primary); cursor: pointer; border-radius: 3px; font-size: 9px; padding: 1px 5px; margin-left: 10px; }
        .btn-mini-add:hover { background: #E3F2FD; }

        /* ÿ£ŸäŸÇŸàŸÜÿ© ÿ≠ÿ∞ŸÅ ÿßŸÑÿ≥ÿ∑ÿ± */
        .row-remover {
            cursor: pointer; color: #B0BEC5; float: right; margin-right: 6px; visibility: hidden; font-size: 11px;
        }
        td:first-child:hover .row-remover { visibility: visible; }
        .row-remover:hover { color: #C62828; }

        /* ÿßŸÑÿ™ÿÆÿ∑Ÿäÿ∑ */
        .row { display: flex; gap: 6px; margin-bottom: 6px; align-items: stretch; flex-wrap: wrap; }
        .col { flex: 1; min-width: 300px; display: flex; flex-direction: column; }

        /* ÿ≥ÿ¨ŸÑ ÿßŸÑÿ£ÿ≠ÿØÿßÿ´ - NARROWED HEIGHT */
        .event-log-box { 
            width: 100%; 
            border: 1px solid var(--border); 
            border-radius: 4px; 
            min-height: 30px;
            height: auto;
            overflow-y: visible;
            background: var(--background); 
            padding: 2px; 
        }
        .log-row { 
            display: flex; 
            align-items: center; 
            gap: 6px; 
            padding: 1px 6px;
            border-bottom: 1px dashed var(--border); 
            font-size: 10px; 
            background: var(--surface); 
            min-height: 20px;
        }
        .log-time-input { 
            width: 55px !important; 
            padding: 0 2px !important; 
            height: 16px !important; 
            border: 1px solid var(--border) !important; 
            border-radius: 3px; 
            font-family: monospace; 
            color: var(--primary); 
            font-weight: bold; 
            font-size: 9px !important; 
            background: var(--sec-vitals) !important; 
            text-align: center; 
        }
        .log-text-input {
            height: 16px !important;
            font-size: 10px !important;
            padding: 0 2px !important;
        }

        /* ÿ™ÿ∞ŸäŸäŸÑ ÿßŸÑÿµŸÅÿ≠ÿ© */
        .timeline-footer {
            position: fixed; bottom: 0; left: 0; width: 100%;
            background: var(--surface); padding: 6px 20px; border-top: 1px solid var(--border);
            display: flex; align-items: center; gap: 6px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.1); z-index: 999;
        }
        .btn-event { border: none; padding: 4px 8px; border-radius: 4px; cursor: pointer; font-weight: 600; font-size: 10px; color: white; white-space: nowrap; display: flex; align-items: center; gap: 4px; }
        .btn-signin { background: var(--evt-signin); }
        .btn-timeout { background: var(--evt-timeout); }
        .btn-crisis { background: var(--evt-crisis); animation: pulse-red 1s infinite; }
        .btn-std { background: var(--evt-std); }

        /* ÿ™ÿ≠ÿ≥ŸäŸÜÿßÿ™ ÿßŸÑÿ∑ÿ®ÿßÿπÿ© */
        @media print {
            @page { size: landscape; margin: 0.5cm; }
            body { background: white; font-size: 8px; color: black; padding: 0; margin: 0; -webkit-print-color-adjust: exact !important; print-color-adjust: exact !important; }
            .no-print, .timeline-footer, .system-top-bar button, .row-remover { display: none !important; }
            .app-container { box-shadow: none; border: none; max-width: 100%; width: 100%; margin: 0; border-top: none; }
            .system-top-bar { background: white !important; color: black !important; border-bottom: 2px solid #000; padding: 2px; text-align: center; display: block; }
            .system-top-bar i { display: none; }
            .patient-context-bar { padding: 2px; background: #fff !important; border: 1px solid #000 !important; margin-bottom: 2px; flex-wrap: nowrap; align-items: center; gap: 4px; }
            .ctx-input { border: 1px solid #999; border-radius: 0; background: transparent; color: black; height: 18px; padding: 1px; }
            .ctx-label { color: #000; font-size: 7px; }
            .cw-card { margin: 0 0 2px 0; border: 1px solid #000; box-shadow: none; border-radius: 0; break-inside: avoid; }
            .cw-card-header { background: #ddd !important; color: black; border-bottom: 1px solid #000; padding: 1px 4px; font-size: 8px; }
            .cw-body { padding: 2px; }
            .details-grid, .airway-grid { gap: 0; border: 1px solid #000; }
            .detail-box { border: 1px solid #000; margin: -1px 0 0 -1px; background: white; height: auto; border-radius: 0; padding: 1px 3px; }
            .detail-box.fixed-h { height: 28px; }
            .detail-box label { color: #000; font-size: 7px; }
            .detail-box input[type="text"] { border-bottom: none; height: 12px; }
            .table-wrap { overflow: visible; max-height: none; background: white; border: 1px solid #000; margin-bottom: 2px; }
            table { width: 100%; border-collapse: collapse; }
            thead th { background: #333 !important; color: white !important; border: 1px solid #000; font-size: 7px; padding: 1px; }
            td { border: 1px solid #999; height: 12px; font-size: 8px; }
            .section-header td { background: #eee !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; color: black; font-weight: bold; }
            td:first-child:not(.section-header td) { border-right: 2px solid #000; background: #eee !important; color: black; font-weight: bold; }
            .section-header.sec-vitals td { background: #FFECB3 !important; }
            .section-header.sec-gases td { background: #B2DFDB !important; }
            .section-header.sec-meds td { background: #BBDEFB !important; }
            .section-header.sec-fluids td { background: #E1BEE7 !important; }
            .row-spacer td { height: 1px; background: #000 !important; border: 1px solid #000; }
            textarea { border: 1px solid #ccc; min-height: 20px; }
            .signature-box input { border-bottom: 1px solid #000 !important; }
        }
    </style>
</head>
<body>

    <div class="app-container">
        <!-- HEADER -->
        <div class="system-top-bar">
            <div style="display:flex; align-items:center; gap:10px;">
                <i class="fas fa-heart-pulse" style="font-size:20px;"></i>
                <div>
                    <div style="font-weight:700; font-size:14px;">CareWare NORA</div>
                    <div style="font-size:9px; opacity:0.8;">Ministry of Health - KSA</div>
                </div>
            </div>
            
            <div class="no-print">
                <button onclick="if(confirm('Clear all data?')) location.reload();" style="background:rgba(255,255,255,0.2); border:1px solid rgba(255,255,255,0.3); color:white; padding:3px 8px; border-radius:4px; cursor:pointer; font-size:10px;">
                    <i class="fas fa-redo"></i> New Case
                </button>
            </div>
        </div>

        <!-- 1. PATIENT CONTEXT BAR -->
        <div class="patient-context-bar">
            <div class="ctx-group w-name">
                <span class="ctx-label">Patient Name</span>
                <input type="text" class="ctx-input" placeholder="Full Name...">
            </div>
            <div class="ctx-group w-mrn">
                <span class="ctx-label">MRN</span>
                <input type="text" class="ctx-input" maxlength="12" placeholder="12 Digits">
            </div>
            <div class="ctx-group w-age">
                <span class="ctx-label">Age</span>
                <input type="text" class="ctx-input" maxlength="2" placeholder="XX">
            </div>
            <div class="ctx-group w-wt">
                <span class="ctx-label">WT(kg)</span>
                <input type="text" class="ctx-input" id="patWt" maxlength="3" value="70">
            </div>
            <div class="ctx-group w-allergies">
                <span class="ctx-label" style="color:var(--danger);">Allergies</span>
                <input type="text" class="ctx-input w-allergies" placeholder="NKA / List...">
            </div>
        </div>

        <!-- 2. CASE DETAILS GRID -->
        <div class="cw-card">
            <div class="cw-card-header">Case Details</div>
            <div class="cw-body">
                <div class="details-grid">
                    <div class="detail-box fixed-h"><label>Procedure Plan</label><input type="text" id="opProp" autocomplete="off"></div>
                    <div class="detail-box fixed-h"><label>Procedure Done</label><input type="text" id="opPerf" autocomplete="off"></div>
                    <div class="detail-box fixed-h"><label>Surgeon</label><input type="text" id="surgeon" autocomplete="off"></div>
                    <div class="detail-box fixed-h"><label>Assistant</label><input type="text" id="asst" autocomplete="off"></div>
                    <div class="detail-box fixed-h"><label>Anaesthetist</label><input type="text" id="anes" autocomplete="off"></div>
                    <div class="detail-box fixed-h"><label>Technician</label><input type="text" id="tech" autocomplete="off"></div>
                </div>
            </div>
        </div>

        <!-- ROW 2: Assessment & Airway (PROPERLY ALIGNED SIDE-BY-SIDE) -->
        <div class="row" style="margin: 0 15px;">
            <!-- Assessment Box -->
            <div class="col">
                <div class="cw-card" style="margin:0; height: 100%;">
                    <div class="cw-card-header"><span><i class="fas fa-notes-medical"></i> Assessment (Pre-Induction)</span></div>
                    <div class="cw-body">
                        <div class="check-group" style="margin-bottom:4px;">
                            <label class="check-item"><input type="checkbox"> Conscious</label>
                            <label class="check-item"><input type="checkbox"> Sedated</label>
                            <label class="check-item"><input type="checkbox"> Unconscious</label>
                            <label class="check-item"><input type="checkbox"> Intubated</label>
                        </div>
                        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:4px; margin-bottom: 4px;">
                            <div class="detail-box"><label>BP</label><input type="text"></div>
                            <div class="detail-box"><label>Pulse</label><input type="text"></div>
                            <div class="detail-box"><label>RR</label><input type="text"></div>
                            <div class="detail-box"><label>SpO2</label><input type="text"></div>
                        </div>
                        <div class="detail-box" style="flex-grow: 1;">
                            <label>Assessment Comments</label>
                            <input type="text" placeholder="Additional notes...">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Airway Management Box -->
            <div class="col">
                <div class="cw-card" style="margin:0; height: 100%;">
                    <div class="cw-card-header"><span><i class="fas fa-lungs"></i> Airway Management</span></div>
                    <div class="cw-body">
                        <!-- Anesthesia Type -->
                        <div class="detail-box" style="margin-bottom: 4px;">
                            <label>Anesthesia Type</label>
                            <div class="check-group" style="border:none; background:transparent; padding:0; min-height:auto;">
                                <label class="check-item"><input type="checkbox"> GA</label>
                                <label class="check-item"><input type="checkbox"> Reg</label>
                                <label class="check-item"><input type="checkbox"> Sed</label>
                            </div>
                        </div>
                        
                        <!-- Airway Device -->
                        <div class="detail-box" style="margin-bottom: 4px;">
                            <label>Airway Device</label>
                            <div class="check-group" style="border:none; background:transparent; padding:0; min-height:auto; gap:6px;">
                                <label class="check-item"><input type="checkbox"> FM</label>
                                <label class="check-item"><input type="checkbox"> ETT</label>
                                <label class="check-item"><input type="checkbox"> LMA</label>
                                <div style="display: flex; gap: 3px; align-items: center; margin-left: auto;">
                                    <input type="text" placeholder="Size" style="width:30px; border-bottom:1px solid #ccc !important; text-align:center; font-size:10px;">
                                    <input type="text" placeholder="Lvl" style="width:30px; border-bottom:1px solid #ccc !important; text-align:center; font-size:10px;">
                                </div>
                            </div>
                        </div>

                        <!-- Intubation / Technique -->
                        <div class="detail-box" style="flex-grow: 1;">
                             <label>Intubation / Technique</label>
                             <div class="check-group" style="border:none; background:transparent; padding:0; min-height:auto; gap:5px;">
                                <label class="check-item"><input type="checkbox"> pre-O2</label>
                                <label class="check-item"><input type="checkbox"> DL</label>
                                <label class="check-item"><input type="checkbox"> VL</label>
                                <label class="check-item"><input type="checkbox"> Oral</label>
                                <label class="check-item"><input type="checkbox"> Nasal</label>
                                <label class="check-item"><input type="checkbox"> RSI</label>
                                <label class="check-item"><input type="checkbox"> Video</label>
                                <label class="check-item"><input type="checkbox"> Fiber</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 3: SMART GRID -->
        <div class="cw-card">
            <div class="cw-card-header">
                <span>Intra-Operative Monitoring</span>
                <span class="no-print" style="font-size:9px; font-weight:normal; color:var(--text-light);">* Set Start Time & Interval</span>
            </div>

            <!-- MONITOR STANDARDS BAR -->
            <div style="padding: 4px 15px; border-bottom: 1px solid var(--border); display: flex; gap: 12px; align-items: center; background: #fff;">
                <span style="font-size: 9px; font-weight: bold; color: var(--text-light);">STANDARDS:</span>
                <div class="check-group" style="border:none; background:transparent; padding:0; min-height:auto; gap: 10px;">
                    <label class="check-item"><input type="checkbox" checked> ECG</label>
                    <label class="check-item"><input type="checkbox" checked> SPO2</label>
                    <label class="check-item"><input type="checkbox" checked> NIBP</label>
                    <label class="check-item"><input type="checkbox"> TEMP</label>
                    <label class="check-item"><input type="checkbox"> ETCO2</label>
                    <label class="check-item" style="display: flex; align-items: center; gap: 4px;">
                        <input type="checkbox"> Other 
                        <input type="text" placeholder="..." style="width: 60px; border: none; border-bottom: 1px solid #ccc !important; font-size: 9px; height: 14px; padding: 0 2px; background: transparent;">
                    </label>
                </div>
            </div>
            
            <div class="grid-toolbar no-print" style="padding:4px 15px; background:var(--background); border-bottom:1px solid var(--border);">
                <div style="display:flex; align-items:center; gap:6px;">
                    <select id="macroSelect" class="macro-select" onchange="applyMacro(this.value)">
                        <option value="">‚ö° Smart Macros</option>
                        <option value="induction">üíâ Standard Induction</option>
                        <option value="emergence">üåÖ Reversal/Emergence</option>
                        <option value="hypotension">üîª Hypotension Bolus</option>
                    </select>
                    
                    <div style="width:1px; height:16px; background:var(--border);"></div>

                    <select id="intervalSelect" class="interval-select" onchange="checkTimeButton()">
                        <option value="" disabled selected>Select Interval</option>
                        <option value="5">5 Min</option>
                        <option value="10">10 Min</option>
                        <option value="15">15 Min</option>
                        <option value="30">30 Min</option>
                    </select>

                    <input type="time" id="gridStartTime" oninput="checkTimeButton()" style="width:90px; font-size: 10px; height: 20px;">
                    
                    <button id="btnAddTime" onclick="addColumn()" disabled>
                        <i class="fas fa-plus"></i> Add Time
                    </button>
                </div>
            </div>
            
            <div class="table-wrap">
                <table id="monitorTable">
                    <thead>
                        <tr id="headerRow">
                            <th>Parameter</th>
                        </tr>
                    </thead>
                    
                    <!-- 1. VITALS SECTION -->
                    <tbody id="tb-vitals">
                        <tr class="section-header sec-vitals">
                            <td><i class="fas fa-heartbeat"></i> VITAL SIGNS</td>
                        </tr>
                        <tr><td>SPO2 (%)</td></tr>
                        <tr><td>ET CO2</td></tr>
                        <tr><td>Heart Rate</td></tr>
                        <tr><td>BP Systolic</td></tr>
                        <tr><td>BP Diastolic</td></tr>
                        <tr><td>Temp (¬∞C)</td></tr>
                    </tbody>

                    <!-- SPACER -->
                    <tbody><tr class="row-spacer"><td></td></tr></tbody>

                    <!-- 2. GASES SECTION -->
                    <tbody id="tb-gases">
                        <tr class="section-header sec-gases">
                            <td style="display:flex; justify-content:space-between; align-items:center;">
                                <span><i class="fas fa-wind"></i> GASES</span>
                                <button onclick="addGasRow()" class="no-print btn-mini-add" title="Add Gas"><i class="fas fa-plus"></i> Row</button>
                            </td>
                        </tr>
                        <tr><td>O2 <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr><td>Air <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr><td>N2O <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr><td>Sevoflurane <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                    </tbody>

                    <!-- SPACER -->
                    <tbody><tr class="row-spacer"><td></td></tr></tbody>

                    <!-- 3. MEDICATIONS SECTION -->
                    <tbody id="tb-meds">
                        <tr class="section-header sec-meds">
                            <td style="display:flex; justify-content:space-between; align-items:center;">
                                <span><i class="fas fa-pills"></i> MEDICATIONS</span>
                                <button onclick="addDrugRow()" class="no-print btn-mini-add" title="Add Drug"><i class="fas fa-plus"></i> Row</button>
                            </td>
                        </tr>
                        <tr data-drug="propofol"><td>Propofol (mg) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr data-drug="fentanyl"><td>Fentanyl (mcg) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr data-drug="roc"><td>Rocuronium (mg) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr data-drug="ephedrine"><td>Ephedrine (mg) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr data-drug="neo"><td>Neostigmine (mg) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr data-drug="glyco"><td>Glyco (mg) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                    </tbody>

                    <!-- SPACER -->
                    <tbody><tr class="row-spacer"><td></td></tr></tbody>

                    <!-- 4. FLUIDS SECTION -->
                    <tbody id="tb-fluids">
                        <tr class="section-header sec-fluids">
                            <td style="display:flex; justify-content:space-between; align-items:center;">
                                <span><i class="fas fa-tint"></i> FLUIDS & OUTPUT</span>
                                <button onclick="addFluidRow()" class="no-print btn-mini-add" title="Add Fluid/Output"><i class="fas fa-plus"></i> Row</button>
                            </td>
                        </tr>
                        <tr><td>Fluids (ml) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr><td>Blood product <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr><td>UOP (ml) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                        <tr style="font-weight:700; color:var(--danger);"><td>Blood Loss (ml) <i class="fas fa-times row-remover" onclick="removeRow(this)"></i></td></tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- ROW 4: Safety & Recovery -->
        <div class="row" style="margin: 0 15px;">
            <div class="col">
                <div class="cw-card" style="margin: 0; height: 100%;">
                    <div class="cw-card-header"><span><i class="fas fa-shield-alt"></i> Safety Checks</span></div>
                    <div class="cw-body">
                        <div class="check-group" style="margin-bottom:4px;">
                            <label class="check-item"><input type="checkbox"> Eyes Taped</label>
                            <label class="check-item"><input type="checkbox"> Press. Pts</label>
                            <label class="check-item"><input type="checkbox"> Warmer On</label>
                            <label class="check-item"><input type="checkbox"> DVT Prophy</label>
                        </div>
                        <div class="row" style="margin-bottom: 0;">
                            <div class="col" style="min-width: 80px;"><label>Tourniquet Time</label><input type="number" style="height:18px; font-size:10px;"></div>
                            <div class="col" style="min-width: 80px;"><label>Pressure</label><input type="number" style="height:18px; font-size:10px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col">
                <div class="cw-card" style="margin: 0; height: 100%;">
                    <div class="cw-card-header"><span><i class="fas fa-bed"></i> Recovery Room (PACU)</span></div>
                    <div class="cw-body">
                        <div style="display:grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap:4px; margin-bottom:4px;">
                            <div class="detail-box"><label>BP</label><input type="text"></div>
                            <div class="detail-box"><label>HR</label><input type="text"></div>
                            <div class="detail-box"><label>RR</label><input type="text"></div>
                            <div class="detail-box"><label>Sat</label><input type="text"></div>
                        </div>
                        <div style="border-top:1px dashed var(--border); padding-top:2px; display:flex; align-items:center; gap:6px;">
                            <label>Aldrete Score</label>
                            <input type="number" style="width:35px; font-weight:bold; font-size:11px; text-align:center; height:18px;">
                            <span>/ 10</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ROW 5: LOG & SIGNATURE -->
        <div class="cw-card">
             <div class="cw-card-header">Timeline Log & Signatures</div>
            <div class="cw-body">
                <div id="eventLogContainer" class="event-log-box" style="margin-bottom:6px;">
                    <div style="color:var(--text-light); font-style:italic; padding:6px; text-align:center;">No events recorded yet.</div>
                </div>

                <label style="font-size: 8px; font-weight: 700; color: var(--text-light); text-transform: uppercase;">Comments</label>
                <textarea style="height:35px; width:100%; margin-bottom:6px; border:1px solid var(--border); border-radius:4px; padding:3px; font-size: 10px;"></textarea>
                
                <div class="row signature-box" style="margin-bottom: 0;">
                    <div class="col"><label>Anesthetist Name</label><input type="text" style="border: 1px solid var(--border); padding: 3px; border-radius: 4px; font-size: 10px; height: 20px;"></div>
                    <div class="col"><label>Signature</label><input type="text" style="font-family:'Brush Script MT', cursive; font-size:18px; color:var(--primary); border:none; border-bottom:1px solid var(--border); background: transparent; height:20px;"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- TIMELINE FOOTER -->
    <div class="timeline-footer no-print">
        <div style="color:var(--text-light); font-weight:bold; font-size:8px; margin-right:4px;">LOG:</div>
        <button class="btn-event btn-signin" onclick="logAction('‚úÖ SIGN IN')">Sign In</button>
        <button class="btn-event btn-timeout" onclick="logAction('üõë TIME OUT')">Time Out</button>
        <div style="width:1px; height:16px; background:var(--border); margin:0 3px;"></div>
        <button class="btn-event btn-std" onclick="logAction('üíâ Induction')">Induction</button>
        <button class="btn-event btn-std" onclick="logAction('ETT Intub')">Intubate</button>
        <button class="btn-event btn-std" onclick="logAction('üü¢ LMA In')">LMA</button>
        <button class="btn-event btn-std" onclick="logAction('üî™ Cut')">Incision</button>
        <button class="btn-event btn-std" onclick="logAction('üòÆ Extub')">Extubate</button>
        <button class="btn-event btn-std" onclick="logAction('')"><i class="fas fa-keyboard"></i> Other</button>
        <div style="width:1px; height:16px; background:var(--border); margin:0 3px;"></div>
        <button class="btn-event btn-crisis" onclick="logAction('‚ö†Ô∏è CRISIS')">CRISIS</button>
        <div style="width:1px; height:16px; background:var(--border); margin:0 3px;"></div>
        <button class="btn-event btn-signin" onclick="logAction('‚úÖ SIGN OUT')">Sign Out</button>
        <button class="btn-event btn-std" onclick="window.print()" style="margin-left:auto; background:var(--text-main);">
            <i class="fas fa-print"></i> Print / PDF
        </button>
    </div>

    <script>
        // --- 1. ÿßŸÑŸÖŸÜÿ∑ŸÇ ÿßŸÑÿ∞ŸÉŸä ŸÑŸÑÿ¨ÿØŸàŸÑ ---
        function checkTimeButton() {
            const timeVal = document.getElementById('gridStartTime').value;
            const intVal = document.getElementById('intervalSelect').value;
            const btn = document.getElementById('btnAddTime');
            if(timeVal && intVal) btn.disabled = false;
            else btn.disabled = true;
        }

        function addColumn() {
            const headerRow = document.getElementById('headerRow');
            const startTime = document.getElementById('gridStartTime').value;
            const intervalVal = parseInt(document.getElementById('intervalSelect').value); 
            
            let label = "";
            if (headerRow.cells.length === 1) {
                label = startTime;
            } else {
                const lastTime = headerRow.cells[headerRow.cells.length-1].innerText;
                let [h, m] = lastTime.split(':').map(Number);
                let date = new Date(); date.setHours(h); date.setMinutes(m + intervalVal);
                label = `${date.getHours().toString().padStart(2,'0')}:${date.getMinutes().toString().padStart(2,'0')}`;
            }

            const th = document.createElement('th');
            th.innerText = label; th.contentEditable = true;
            headerRow.appendChild(th);

            const tbodies = document.querySelectorAll('#monitorTable tbody');
            tbodies.forEach(tbody => {
                if (tbody.querySelector('.row-spacer')) return;
                const rows = tbody.rows;
                for(let row of rows) {
                    if(row.classList.contains('section-header')) {
                        row.cells[0].colSpan = headerRow.cells.length;
                        continue;
                    }
                    const cell = row.insertCell(-1);
                    const input = document.createElement('input');
                    input.type = "text";
                    cell.appendChild(input);
                }
            });
        }

        function applyMacro(type) {
            const headerRow = document.getElementById('headerRow');
            if(headerRow.cells.length <= 1) {
                document.getElementById('macroSelect').value = "";
                return;
            }
            const colIndex = headerRow.cells.length - 1; 
            const weight = parseFloat(document.getElementById('patWt').value) || 70;
            let drugs = {};
            if(type === 'induction') {
                drugs = { 'propofol': Math.round(weight * 2), 'fentanyl': Math.round(weight * 1.5), 'roc': Math.round(weight * 0.6) };
                logAction(`üíâ Macro: Induction (Wt: ${weight}kg)`);
            } else if (type === 'emergence') {
                drugs = { 'neo': '2.5', 'glyco': '0.4' };
                logAction(`üåÖ Macro: Reversal`);
            } else if (type === 'hypotension') {
                drugs = { 'ephedrine': '5' };
                logAction(`üîª Macro: Ephedrine Bolus`);
            }
            const medRows = document.getElementById('tb-meds').rows;
            for(let row of medRows) {
                const drugKey = row.getAttribute('data-drug');
                if(drugKey && drugs[drugKey]) {
                    const input = row.cells[colIndex].querySelector('input');
                    if(input) { input.value = drugs[drugKey]; input.classList.add('dose-filled'); setTimeout(() => input.classList.remove('dose-filled'), 1000); }
                }
            }
            document.getElementById('macroSelect').value = "";
        }

        let timelineEvents = [];
        function logAction(text) {
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            timelineEvents.push({ id: Date.now(), time: timeStr, text: text });
            renderTimeline();
        }

        function renderTimeline() {
            timelineEvents.sort((a, b) => a.time.localeCompare(b.time));
            const container = document.getElementById('eventLogContainer');
            container.innerHTML = '';
            if(timelineEvents.length === 0) { container.innerHTML = '<div style="color:var(--text-light); font-style:italic; padding:10px; text-align:center;">No events recorded yet.</div>'; return; }
            timelineEvents.forEach(evt => {
                const row = document.createElement('div');
                row.className = 'log-row';
                row.innerHTML = `
                    <input type="time" value="${evt.time}" onchange="updateEventTime(${evt.id}, this.value)" class="log-time-input">
                    <input type="text" value="${evt.text}" onchange="updateEventText(${evt.id}, this.value)" class="log-text-input" style="flex:1; border:none; background:transparent;">
                    <span class="delete-log" onclick="deleteEvent(${evt.id})" style="cursor:pointer; color:var(--text-light);"><i class="fas fa-times"></i></span>
                `;
                container.appendChild(row);
            });
        }

        function updateEventTime(id, newTime) { const evt = timelineEvents.find(e => e.id === id); if(evt) { evt.time = newTime; renderTimeline(); } }
        function updateEventText(id, newText) { const evt = timelineEvents.find(e => e.id === id); if(evt) evt.text = newText; }
        function deleteEvent(id) { 
            timelineEvents = timelineEvents.filter(e => e.id !== id); 
            renderTimeline(); 
        }

        function addGasRow() { const tbody = document.getElementById('tb-gases'); createGenericRow(tbody, "New Gas..."); }
        function addDrugRow() { const tbody = document.getElementById('tb-meds'); createGenericRow(tbody, "New Drug..."); }
        function addFluidRow() { const tbody = document.getElementById('tb-fluids'); createGenericRow(tbody, "New Fluid/Output..."); }

        function createGenericRow(tbody, placeholderText) {
            const headerRow = document.getElementById('headerRow');
            const colCount = headerRow.cells.length;
            const newRow = document.createElement('tr');
            const cell1 = document.createElement('td');
            const input = document.createElement('input');
            input.type = "text"; 
            input.placeholder = placeholderText; 
            input.style.fontWeight = "bold"; 
            input.style.textAlign = "left"; 
            input.style.paddingLeft = "5px"; 
            input.style.color = "var(--primary)";
            input.style.width = "calc(100% - 25px)";
            input.style.fontSize = "10px";
            
            cell1.appendChild(input);
            const removeIcon = document.createElement('i');
            removeIcon.className = "fas fa-times row-remover";
            removeIcon.onclick = function() { removeRow(this); };
            cell1.appendChild(removeIcon);
            newRow.appendChild(cell1);
            
            for(let i = 1; i < colCount; i++) {
                const cell = newRow.insertCell(-1);
                const valInput = document.createElement('input');
                valInput.type = "text";
                cell.appendChild(valInput);
            }
            tbody.appendChild(newRow);
        }

        function removeRow(icon) { 
            const row = icon.closest('tr'); 
            row.remove(); 
        }
    </script>
</body>
</html>
